const axios = require('axios');
const fs = require('fs');

function getRandomEmail() {
    const randomString = Math.random().toString(36).substring(2, 12);
    return randomString + '@gmail.com';
}


async function makeRequest() {

    const email = getRandomEmail()
    const response = await axios.post(
        'https://api.ecomsend.com/v2/store-frontend/28039315529/popups/116068/draw',
        {
          email,
          first_name: "",
          last_name: "",
          gdpr: false,
          tcpa: false,
          locale: "en",
          referrer: "https://epomaker.com/products/epomaker-shadow-x"
        },
        {
          headers: {
            'accept': '*/*',
            'accept-language': 'en-US,en;q=0.9',
            'access-control-allow-origin': '*',
            'cache-control': 'max-age=0',
            'content-type': 'application/json',
            'dnt': '1',
            'origin': 'https://epomaker.com',
            'priority': 'u=1, i',
            'referer': 'https://epomaker.com/',
            'sec-ch-ua': '"Not?A_Brand";v="99", "Chromium";v="130"',
            'sec-ch-ua-mobile': '?0',
            'sec-ch-ua-platform': '"Windows"',
            'sec-fetch-dest': 'empty',
            'sec-fetch-mode': 'cors',
            'sec-fetch-site': 'cross-site',
            'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36'
          }
        }
      )
    return response.data
}

async function main() {
  console.log('Making a request...')
  const data = await makeRequest()
  const vouchers = await fs.readFileSync('vouchers.json')
  const vouchersJson = JSON.parse(vouchers)
  if (data.reward.label == '$3 Voucher') {
    console.log('Got $3 Voucher')
    vouchersJson['$3'].push(data.discount_code)
  }
  if (data.reward.label == '$5 Voucher') {
    console.log('Got $5 Voucher')
    vouchersJson['$5'].push(data.discount_code)
  }
  if (data.reward.label == '$6 Voucher') {
    console.log('Got $6 Voucher')
    vouchersJson['$6'].push(data.discount_code)
  }
  if (data.reward.label == '$8 Voucher') {
    console.log('Got $8 Voucher')
    vouchersJson['$8'].push(data.discount_code)
  }
  fs.writeFileSync('vouchers.json', JSON.stringify(vouchersJson, null, 2))
}

// setInterval(main, 1000 * 60 * 10)
main()